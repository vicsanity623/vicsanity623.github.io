<!DOCTYPE html>
<html lang="en">
<head>
    <!-- YOUR GOOGLE ADSENSE SCRIPT - UNCHANGED -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5972331036113330"
     crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Separate audio files into instrumental stems (vocals, drums, bass, other) using our free online Demucs-powered tool. Upload MP3, WAV, FLAC, and more.">
    <meta name="keywords" content="audio stem separation, demucs, music separation, isolate vocals, remove drums, instrumental maker, karaoke maker, audio tool, vicsanity">
    <title>Free Audio Stem Separator - Powered by Demucs</title>
    
    <!-- GOOGLE ANALYTICS TAG - UNCHANGED -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4686TXHCHN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-4686TXHCHN');
    </script>
    
    <!-- ORIGINAL STYLES - UNCHANGED -->
    <style>
        :root {
            --primary-bg: #1e1e2f;
            --secondary-bg: #27293d;
            --accent-color: #00bcd4;
            --text-color: #f8f8f2;
            --input-bg: #44475a;
            --success-color: #50fa7b;
            --error-color: #ff5555;
            --border-radius: 8px;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: var(--font-family); 
            background-color: var(--primary-bg); 
            color: var(--text-color); 
            overscroll-behavior-y: contain; 
            line-height: 1.6;
        }
        .main-content-wrapper { max-width: 900px; margin: 0 auto; padding: 20px; }
        .app-container { display: flex; flex-direction: column; align-items: center; padding: 40px 20px; text-align: center; background-color: var(--secondary-bg); border-radius: var(--border-radius); margin-bottom: 40px; }
        .title { font-size: 2.5em; margin-bottom: 10px; color: var(--accent-color); font-weight: 300; }
        .subtitle { font-size: 1.1em; margin-bottom: 30px; color: #bd93f9; max-width: 600px; margin-left: auto; margin-right: auto;}
        
        /* MODIFIED FOR COLAB */
        .colab-url-group { width: 100%; max-width: 500px; margin-bottom: 20px; text-align: left; }
        .colab-url-input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            font-size: 1em;
            background-color: var(--input-bg);
            border: 1px solid var(--accent-color);
            border-radius: var(--border-radius);
            color: var(--text-color);
            outline: none;
        }

        .upload-group { width: 100%; max-width: 500px; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center; }
        .file-input-label { display: inline-block; padding: 12px 20px; font-size: 1em; font-weight: bold; color: var(--text-color); background-color: var(--input-bg); border: 1px dashed var(--accent-color); border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.3s ease, border-color 0.3s ease; margin-bottom: 15px; }
        .file-input-label:hover { background-color: #5a5d74; border-color: #00acc1; }
        #audioFile { display: none; }
        #fileNameDisplay { font-size: 0.9em; color: #bd93f9; min-height: 1.2em; margin-bottom: 15px; word-break: break-all; }
        .filename-tip { font-size: 0.8em; color: #bd93f9; margin-top: 10px; max-width: 480px; line-height: 1.4; }
        .action-button { padding: 15px 30px; font-size: 1.1em; font-weight: bold; color: var(--text-color); background-color: var(--accent-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.3s ease, transform 0.1s ease; outline: none; width: 100%; max-width: 500px; }
        .action-button:hover { background-color: #00acc1; }
        .action-button:active { transform: scale(0.98); }
        .action-button:disabled { background-color: #6272a4; cursor: not-allowed; }
        .status-message { margin-top: 20px; font-size: 1em; min-height: 1.2em; font-weight: 500; white-space: pre-wrap; }
        .status-message.success { color: var(--success-color); }
        .status-message.error { color: var(--error-color); }
        .spinner { display: none; border: 4px solid rgba(248, 248, 242, 0.3); border-radius: 50%; border-top: 4px solid var(--accent-color); width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto 0; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .content-section { text-align: left; margin-bottom: 40px; padding: 20px; background-color: var(--secondary-bg); border-radius: var(--border-radius); }
        .content-section h2 { color: var(--accent-color); margin-bottom: 15px; font-size: 1.8em; font-weight: 400; border-bottom: 1px solid var(--input-bg); padding-bottom: 10px; }
        .content-section p, .content-section ul, .content-section ol { margin-bottom: 15px; color: var(--text-color); }
        .content-section ul, .content-section ol { list-style-position: outside; padding-left: 20px; }
        .content-section li { margin-bottom: 8px; }
        .content-section a { color: var(--accent-color); text-decoration: none; }
        .content-section a:hover { text-decoration: underline; }
        .image-container { display: flex; justify-content: center; align-items: center; width: 100%; max-width: 500px; min-height: 200px; margin: 20px auto; background-color: var(--input-bg); border-radius: var(--border-radius); overflow: hidden; }
        .image-container img { max-width: 100%; max-height: 300px; object-fit: contain; border-radius: calc(var(--border-radius) - 4px); }
        footer { background-color: var(--secondary-bg); padding: 20px; text-align: center; border-top: 1px solid var(--input-bg); margin-top: 40px; font-size: 14px; color: var(--text-color); }
        footer a { color: var(--accent-color); text-decoration: none; margin: 0 10px; }
        footer a:hover { text-decoration: underline; }
        footer div { margin-top: 10px; }
        footer .copyright-text, footer .disclaimer-text { color: #bd93f9; }
        footer .disclaimer-text { font-size: 12px; }
        .visitor-counter-container { margin-bottom: 15px; }
    </style>
    <meta name="google-site-verification" content="mxPAv2VJ1TR5Heht38zsEerPZyIJltVRLFiN1zyfjJY" />
</head>
<body>
    <div class="main-content-wrapper">
        <div class="app-container">
            <h1 class="title">Online Audio Stem Separator</h1>
            <p class="subtitle">Easily isolate vocals and instruments from your audio tracks using a Demucs model running on Google Colab.</p>

            <!-- NEW: COLAB URL INPUT -->
            <div class="colab-url-group">
                <label for="colabUrl"><strong>NGROK Server:</strong> Active Google Colab (ngrok) URL</label>
                <input type="text" id="colabUrl" class="colab-url-input" value="https://fee77ada0e43.ngrok-free.app">
            </div>

            <div class="upload-group">
                <label for="audioFile" class="file-input-label"><strong>Step 2:</strong> Choose Audio File</label>
                <input type="file" id="audioFile" name="audioFile" accept=".mp3,.wav,.m4a,.aac,.ogg,.flac">
                <p id="fileNameDisplay">No file selected</p>
                <p class="filename-tip"><strong>How it works:</strong> This tool connects directly to A Google Colab session. Processing time depends on the song length and Colab's GPU. A 5-minute song typically takes a few minutes.</p>
            </div>

            <button id="processBtn" class="action-button" disabled>Separate Stems</button>

            <div id="spinner" class="spinner"></div>
            <p id="statusMessage" class="status-message"></p>
        </div>
        
        <!-- All original informational sections below are unchanged -->
        <section class="content-section" id="how-to-use">
            <h2>How to Use This Stem Separator</h2>
            <p>Getting your audio stems is simple:</p>
            <ol>
                <li><strong>Choose Audio File:</strong> Click the "Choose Audio File" button and select an audio file from your device. We support common formats like MP3, WAV, FLAC, M4A, AAC, and OGG.</li>
                <li><strong>Process & Download:</strong> Click the "Separate Stems" button. The file will be uploaded to your Colab notebook for processing. Once finished, a ZIP file containing the stems will automatically download.</li>
            </ol>
        </section>

        <section class="content-section" id="what-is-stem-separation">
            <h2>Unlock Your Audio: What is Stem Separation?</h2>
            <p>Stem separation is the process of isolating individual instrumental and vocal tracks (called "stems") from a mixed audio recording. Imagine having a finished song and being able to extract just the vocals, or only the drum track – that's the magic of stem separation!</p>
            <div class="image-container">
                <img src="https://raw.githubusercontent.com/vicsanity623/vicsanity623.github.io/refs/heads/main/Audio%20MIX%20Source.png" alt="Diagram illustrating audio stem separation from a mixed track into vocals, drums, bass, and other instruments.">
            </div>
        </section>

        <section class="content-section" id="about-demucs">
            <h2>Powered by Demucs: State-of-the-Art AI</h2>
            <p>This online tool utilizes <strong>Demucs</strong>, a cutting-edge deep learning model for music source separation developed by Meta AI. Demucs is renowned for its high-quality separation capabilities, leveraging advanced neural network architectures.</p>
        </section>

        <section class="content-section" id="use-cases">
            <h2>Creative Possibilities: What Can You Do With Stems?</h2>
            <p>Audio stems open up a vast array of creative and practical applications for DJs, producers, and musicians, including remixing, creating karaoke tracks, and learning instrument parts.</p>
        </section>
        
        <section class="content-section" id="legal-and-ethical-use">
            <h2>Important: Legal & Ethical Considerations</h2>
            <p>While stem separation technology is powerful, it's crucial to use it responsibly. You should only process audio files for which you own the copyright or have explicit permission from the copyright holders. The responsibility for ensuring copyright compliance rests entirely with you, the user.</p>
        </section>
    </div>

    <!-- REWRITTEN SCRIPT FOR COLAB WORKFLOW -->
    <script>
        const colabUrlInput = document.getElementById('colabUrl');
        const audioFileInput = document.getElementById('audioFile');
        const processBtn = document.getElementById('processBtn');
        const statusMessage = document.getElementById('statusMessage');
        const spinner = document.getElementById('spinner');
        const fileNameDisplay = document.getElementById('fileNameDisplay');

        let selectedFile = null;

        function updateButtonState() {
            const url = colabUrlInput.value.trim();
            const isValidUrl = url.startsWith('https://') && (url.includes('ngrok-free.app') || url.includes('ngrok.io'));
            processBtn.disabled = !selectedFile || !isValidUrl;
        }

        colabUrlInput.addEventListener('input', updateButtonState);

        audioFileInput.addEventListener('change', (event) => {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                fileNameDisplay.textContent = `Selected: ${selectedFile.name}`;
            } else {
                fileNameDisplay.textContent = 'No file selected';
            }
            setStatus(''); // Clear any previous status messages
            updateButtonState();
        });

        processBtn.addEventListener('click', async () => {
            if (!selectedFile || !colabUrlInput.value) {
                setStatus('Please select a file.', 'error');
                return;
            }
            
            // --- UI Reset and Setup ---
            processBtn.disabled = true;
            processBtn.textContent = 'Processing...';
            spinner.style.display = 'block';
            setStatus('Uploading file to Colab. This may take a moment...', '');

            const formData = new FormData();
            formData.append('audioFile', selectedFile);

            // Construct the final endpoint URL
            const serverEndpoint = `${colabUrlInput.value.trim()}/separate`;

            try {
                // --- Fetch API Call to Colab ---
                const response = await fetch(serverEndpoint, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    let errorMsg = `Server error: ${response.status}. See Colab for details.`;
                    try {
                        const errorData = await response.json();
                        if (errorData && errorData.error) {
                            errorMsg = errorData.error;
                        }
                    } catch (e) {
                        // The response might not be JSON, just use the status text
                        errorMsg = `Server error: ${response.status} ${response.statusText}`;
                    }
                    throw new Error(errorMsg);
                }
                
                setStatus('Processing complete! Downloading your stems...', 'success');

                // --- Handle the File Download ---
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = downloadUrl;
                
                // Create a default filename
                const originalFilenameBase = selectedFile.name.substring(0, selectedFile.name.lastIndexOf('.')) || 'audio';
                a.download = `${originalFilenameBase}_stems.zip`;
                
                document.body.appendChild(a);
                a.click();
                
                // Clean up the created URL object after download
                window.URL.revokeObjectURL(downloadUrl);
                a.remove();

            } catch (error) {
                console.error('Error during separation:', error);
                setStatus(`An error occurred: ${error.message}`, 'error');
            } finally {
                // --- Reset UI after a short delay to allow user to see the success message ---
                setTimeout(() => {
                    processBtn.textContent = 'Separate Stems';
                    spinner.style.display = 'none';
                    audioFileInput.value = null; // Clear the file input
                    fileNameDisplay.textContent = 'No file selected';
                    selectedFile = null;
                    updateButtonState(); // This will disable the button
                    if (!statusMessage.classList.contains('error')) {
                       setStatus('');
                    }
                }, 4000);
            }
        });

        function setStatus(message, type = '') {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message'; // Reset classes
            if (type) {
                statusMessage.classList.add(type);
            }
        }
        
        // Initial check in case the URL is pre-filled
        document.addEventListener('DOMContentLoaded', updateButtonState);
    </script>
    
    <!-- ORIGINAL FOOTER - UNCHANGED -->
    <footer>
        <div>
            <a href="/privacy-policy.html">Privacy Policy</a> |
            <a href="/terms-of-service.html">Terms of Service</a> |
            <a href="https://github.com/vicsanity623/vicsanity623.github.io">GitHub Repository</a> |
            <a href="rpg.html">Play Tap Guardian RPG</a> |
            <a href="EndlessRift/index.html">Play Survive It</a> |
            <a href="Entity/index.html">Play Entity Simulator</a>
        </div>
        <div class="visitor-counter-container">
            <a href="https://www.hitwebcounter.com" target="_blank">
            <img src="https://hitwebcounter.com/counter/counter.php?page=20795911&style=0009&nbdigits=6&type=ip&initCount=109" title="Counter Widget" Alt="Visit counter For Websites"   border="0" /></a>
        </div>
        <div class="copyright-text">
            © 2025 Audio Stem Separator. This service uses <a href="https://github.com/facebookresearch/demucs" target="_blank" rel="noopener noreferrer">Demucs</a>, an open-source project by Meta AI, under the MIT License.
        </div>
        <div class="disclaimer-text">
            Please do not upload copyrighted material unless you own the rights or have explicit permission. Users are solely responsible for the content they process.
        </div>
    </footer>
</body>
</html>
